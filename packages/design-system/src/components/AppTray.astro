---
interface NavItem {
  icon: string;
  label: string;
  href: string;
  active?: boolean;
}

interface Props {
  items: NavItem[];
}

// biome-ignore lint/correctness/noUnusedVariables: used in template
const { items } = Astro.props;
---

<div class="app-tray">
  <input type="checkbox" id="app-tray-toggle" class="app-tray__toggle" />

  <label for="app-tray-toggle" class="app-tray__burger" aria-label="Toggle navigation">
    <span class="app-tray__burger-icon app-tray__burger-icon--menu material-symbols-sharp" aria-hidden="true">menu</span>
    <span class="app-tray__burger-icon app-tray__burger-icon--close material-symbols-sharp" aria-hidden="true">close</span>
  </label>

  <aside class="app-tray__rail">
    {items.map((item) => (
      <a class="app-tray__rail-item" href={item.href} data-active={item.active ? "" : undefined}>
        <span class="app-tray__rail-icon material-symbols-sharp" aria-hidden="true">{item.icon}</span>
      </a>
    ))}
  </aside>

  <nav id="app-tray-nav" class="app-tray__drawer" aria-label="Main navigation">
    <div class="app-tray__drawer-header"></div>
    {items.map((item) => (
      <a class="app-tray__nav-item" href={item.href} data-active={item.active ? "" : undefined}>
        <span class="app-tray__nav-icon material-symbols-sharp" aria-hidden="true">{item.icon}</span>
        {item.label}
      </a>
    ))}
  </nav>

  <label for="app-tray-toggle" class="app-tray__scrim" aria-label="Close navigation"></label>
</div>

<script>
  const toggle = document.getElementById("app-tray-toggle");
  const drawer = document.getElementById("app-tray-nav");
  if (toggle && drawer) {
    const isOverlay = () => !window.matchMedia("(min-width: 780px)").matches;

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && toggle.checked) {
        toggle.checked = false;
      }

      if (
        e.key === "Tab" &&
        toggle.checked &&
        isOverlay()
      ) {
        const focusable = drawer.querySelectorAll(
          'a, button, [tabindex]:not([tabindex="-1"])',
        );
        if (focusable.length === 0) return;

        const first = focusable[0];
        const last = focusable[focusable.length - 1];

        if (e.shiftKey && document.activeElement === first) {
          e.preventDefault();
          last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
          e.preventDefault();
          first.focus();
        }
      }
    });
  }
</script>
