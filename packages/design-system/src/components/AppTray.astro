---
// biome-ignore lint/correctness/noUnusedImports: used in template
import DrawerBrand from "./DrawerBrand.astro";
// biome-ignore lint/correctness/noUnusedImports: used in template
import HamburgerButton from "./HamburgerButton.astro";
// biome-ignore lint/correctness/noUnusedImports: used in template
import TrayButton from "./TrayButton.astro";

interface NavItem {
  icon: string;
  label: string;
  href: string;
  active?: boolean;
}

interface Props {
  items: NavItem[];
  brandHref?: string;
}

// biome-ignore lint/correctness/noUnusedVariables: used in template
const { items, brandHref } = Astro.props;
---

<div class="app-tray">
    <div class="app-tray__burger-wrapper">
        <HamburgerButton id="app-tray-toggle" />
    </div>

    <div class="app-tray__rail-column" data-tray-state="minimized">
        <nav
            id="app-tray-nav"
            class="app-tray__nav"
            aria-label="Main navigation"
        >
            {
                items.map((item: NavItem) => (
                    <TrayButton
                        icon={item.icon}
                        label={item.label}
                        href={item.href}
                        active={item.active}
                    />
                ))
            }
        </nav>
        <DrawerBrand href={brandHref} />
    </div>

    <label
        for="app-tray-toggle"
        class="app-tray__scrim"
        aria-label="Close navigation"></label>
</div>

<script>
    const toggle = document.getElementById(
        "app-tray-toggle",
    ) as HTMLInputElement | null;
    const drawer = document.getElementById("app-tray-nav");

    if (toggle && drawer) {
        const isOverlay = () =>
            !window.matchMedia("(min-width: 780px)").matches;

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && toggle.checked) {
                toggle.checked = false;
            }

            if (e.key === "Tab" && toggle.checked && isOverlay()) {
                const focusable = drawer.querySelectorAll<HTMLElement>(
                    'a, button, [tabindex]:not([tabindex="-1"])',
                );
                if (focusable.length === 0) return;

                const first = focusable[0];
                const last = focusable[focusable.length - 1];

                if (e.shiftKey && document.activeElement === first) {
                    e.preventDefault();
                    last.focus();
                } else if (!e.shiftKey && document.activeElement === last) {
                    e.preventDefault();
                    first.focus();
                }
            }
        });
    }
</script>
